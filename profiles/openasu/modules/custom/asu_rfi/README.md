DESCRIPTION
--------------------------
The ASU RFI module provides ASU sites with RFI form functionality with
automatic posting to ASU's SalesForce middleware (which forwards
submissions into Salesforce separately from this site).

INSTALLATION
--------------------------
**Prerequisite**: ASU Academic Programs (asu_ap). In order to populate the
program/degree options in the RFI forms, you must use the ASU Academic Programs
module to import degree programs into your site. While installing the asu_ap
module doesn't have to be done prior to installing this module, the
configuration forms for the RFI forms will not function properly until that 
is completed. (See the asu_ap module's README.txt for more information.)

Simply enable the ASU Request for Information (asu_rfi) and ASU RFI feature
(asu_rfi_feature) modules as usual (See http://drupal.org/node/70151 for
further information on enabling Drupal modules).

CONFIGURATION
--------------------------
Post installation, the ASU RFI module requires configuration in order to post
to the middleware and deploy the forms throughout your site.

### Global configuration

* Site-wide RFI settings are made at /admin/config/asu/asurfi.

* To use the middleware, you *must* obtain an authentication key from
https://webforms.asu.edu/content/access-rfi-middleware-request
If you deploy forms to your site without an authentication key configured,
your site will collect lead submissions but not submit them to middleware.

* The Google Analytics identifier is a short string you choose yourself. It will
show up in ASU's Google Analytics reports, to help differentiate your entries
from other sites.

* The Confirmation Web Page settings allows you to provide the Node ID (NID)
of a page you've created, from which to obtain confirmation/thank you content.
The content used will come from that page's body.

* View the RFI form submissions stored in your site at
/admin/reports/asu-rfi-submissions-report
From this Views Bulk Operation view of lead submissions, you can see which
submissions have succeeded or failed, resubmit failed leads to the middleware,
and export leads to CSV.

### RFI Form deployment & configuration

#### Creating a RFI form block

RFI forms are deployed to your site via the Drupal blocks system, with help
from the Multiblock module.

The ASU RFI module provides a master block titled "RFI Master." You won't use
that block; instead, you will instead create an "instance" (i.e. copy) of that
block that will contain a new, individual RFI form to place in your site.

You can create as many instances of the RFI Master block as you want. (We
recommend giving them descriptive names, to aid in administering them later.)

Go to Admin > Structure > Blocks > Instances (/admin/structure/block/instances).
Under Add Instance, enter a descriptive name and select "RFI Master" for Block type.

#### Adding a RFI form block to web content

Once you've created an instance, it will appear in the main blocks admin page
(Admin > Structure > Blocks, or /admin/structure/block), where you can deploy it to
regions in your theme, apply access controls, etc.

**For WebSpark (or Panopoly/Panels) users**: RFI forms can also be assigned to
panels in the site through its interface the same way you would add other ASU Web
standards elements.

##### SPECIAL CASE: The Multiform option

The multiform option:

* ..must ONLY be used on an ASU Academic Programs content type page (typically generated by the asu_ap module) because it requires that page's academic plan code. The form will not autofill certain required form fields without that data.

* ..cannot be added in Panels because it **must** be added to a page-level region called "Prefooter" or it will not display. Panels only allows the selection of node-level regions (which are all within the area of the page-level region called "Content"), so the multiform must be added to pages in that block's configuration form or at Admin > Structure > Blocks.

#### Configuring individual RFI form blocks

Each RFI block instance has its own independent settings, configurable through Admin > Structure  > Blocks > [your block] Configure. It's here where you define which form type to use (multistep, undegraduate long form, graduate long form, current undergraduate form, current graduate form).

Some of the form types automatically define which programs will be listed in the form while others allow you to manually determine the program options.

For more detailed instructions on configuration, go to 
https://brandguide.asu.edu/executing-the-brand/web-and-mobile/webspark/features/asu_rfi.

SUBMISSION STATUS
--------------------------
When most RFI forms' HTML form are submitted properly, the form's submission is saved in the site's database and the status is immediately set to "Form_Completed".

The process isn't over yet, however. During the same submission process (same HTTP request), but AFTER the "Complete" status is set, the module immediately tries to submit a modified version of the submission data to one of multiple SalesForce middleware servers (depending on which type of form, the determined environment type (dev/test/prod), and whether it's in testing mode or not based on settings at /admin/config/content/asurfi). 

If that additional submission to the middleware is also successful, then the process is truly completed and the status of the form submission is updated to "SF_Completed." This is the final status you want to see for all submissions.

* Status exception for multistep/multipage forms: When the 1st page multiform is saved in the site database successfully, the submission's status is set to "Form_Multi_Partial" (in lieu of "Complete"). This status will remain until either 1) the second half of the form is also submitted on the next/last page (which sets it to "Complete"), or 2) the site's cron job is run. At that time, the site tries (during the same HTTP request) to submit the submission to the middleware (the same as above). This will end up with a status of "SF_Completed" (success) or an error is returned and the status is set to ("SF_Failed").

Cron jobs will attempt to process all "Pending" or "Form_Multi_Partial" submissions that aren't beyond 10 days old. If the status is "SF POST Pending", its status is set to "SF_Failed" and the module makes one more attempt to POST the data to the middleware. If that POST fails, no future, automated attempts will be made to submit the data. A site administrator will need to resolve the issue and post it manually at /admin/reports/asu-rfi-submissions-report under "Operations" (views_bulk_operations).

See /admin/reports/asu-rfi-submissions-report for the list of submissions and their statuses.

PERMISSIONS
--------------------------
'Administer ASU RFI module' - access the module's admin.

Additional access and permissions considerations to the RFI forms themselves
can be managed through the Drupal blocks system's access controls.

MODULES
--------------------------
Module ships with ASU RFI Feature module.

See .info files for dependencies.

PAGES
--------------------------
Module provides
Admin settings: /admin/config/asu/asurfi

Block and Instances configurations
/admin/structure/block
/admin/structure/block/instances

Listing of submissions and their statuses (a Drupal view called "RFI lead submissions")
/admin/reports/asu-rfi-submissions-report
/admin/content (filter for content type "ASU RFI form submissions")

TABLES
--------------------------
* asu_rfi_states_list - List of states for RFI forms
* asu_rfi_countries - List of countries for RFI forms
* asu_rfi_sem_dates - List of available semester dates

BLOCKS
--------------------------
RFI Master block - DO NOT USE!
Instead, create Block Instances for individual RFI forms based off the RFI Master
block.

HOOKS
--------------------------
None.

TROUBLESHOOTING
--------------------------
#### Known issues

**No available majors are available to select in the block's configuration form.**

Make sure the ASU Academic Programs module is enabled, and that you have imported
the desired degrees/programs. (See that module's README for more information.)

**This module was working with the ASU Degrees module pulling in the desired degrees,
but it broke after a Webspark update. What happened?**

The ASU Degrees module has been superseded by the ASU Academic Programs (asu_ap) module.
The former module no longer works with the ASU Degrees module. (See the asu_ap
module's README for more information.)

**I've updated the degrees in the site, but the new major options aren't
appearing in the block's configuration form.**

If you use caching in your site, RFI form blocks configured so they automatically
detect context and determine which programs to display can get cached and display
incorrect options. To avoid this issue, enable the Ajax Block module, and on the
block configuration page, set the block to load via Ajax. That means an un-cached
copy of the form will be added to the page via Javascript after the cached page loads.
This occurs very quickly and doesn't affect the user experience to any great degree.

**I'm a non-Webspark user, and the block configurations on RFI form instances are not saving.**

In order to avoid a per-instance bug with the Multiblock module where it forgets
settings, you should apply the patch in comment #5 on:
https://www.drupal.org/node/1370966#comment-6408056.) Webspark has had that patch
applied to resolve that issue.

**I don't see my issue listed below, and I've read through the instructions at
https://brandguide.asu.edu/executing-the-brand/web-and-mobile/webspark/features/asu_rfi.
What do I do?**

Go to https://drupal.asu.edu/wcs for assistance.

CREDITS
--------------------------
ASU RFI module was created by
Archana Puliroju <apuliroj@asu.edu> and
Michael Samuelson <mlsamuel@asu.edu>

Updated by Bryan Roseberry <jax@asu.edu>

Maintained by Development, Applications and Design in the UTO.
