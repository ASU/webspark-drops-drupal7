<?php
/**
 * @file
 * Drupal needs this blank file.
 */

/**
 * Implements hook_init().
 **/
function webspark_megamenu_init() {
  drupal_add_js(libraries_get_path('emulatetab') . '/src/emulatetab.joelpurra.min.js');
  $ws2_check = _webspark_featurescustom_ws2_check();
  drupal_add_js(drupal_get_path('module', 'webspark_megamenu') . '/js/webspark_megamenu' . $ws2_check . '.js', 'file');
  drupal_add_css(drupal_get_path('module', 'webspark_megamenu') . '/css/webspark_megamenu' . $ws2_check . '.css', array('weight' => 99, 'group' => CSS_DEFAULT));
}

/**
 * Implements hook_page_alter().
 **/
function webspark_megamenu_page_alter(&$page) {
  $ws2_check = _webspark_featurescustom_ws2_check();
  drupal_add_js(drupal_get_path('module', 'webspark_megamenu').'/js/webspark_megamenu_pre' . $ws2_check . '.js', array('scope'=>'header'));
}

/**
 * Implements hook_libraries_info().
 */
function webspark_megamenu_libraries_info() {
  $libraries['emulatetab'] = array(
    'name' => 'EmulateTab',
    'vendor url' => 'https://github.com/joelpurra/emulatetab',
    'download url' => 'https://raw.githubusercontent.com/joelpurra/emulatetab/gh-pages/dist/emulatetab.joelpurra.min.js',
    'path' => 'profiles/openasu/libraries/emulatetab/src',
    // Version v0.2.8
    'files' => array(
      'js' => array('emulatetab.joelpurra.js'),
    ),
  );
  return $libraries;
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function webspark_megamenu_form_system_site_information_settings_alter(&$form, &$form_state, $form_id) {
  // Adds unit title to /admin/config/system/site-information
  $form['site_information']['site_unit_name'] = array(
    '#type' => 'textfield',
    '#title' => 'Parent unit - Name',
    '#default_value' => variable_get('site_unit_name', ''),
    '#description' => 'Parent unit at ASU. This will appear in the global header above the subdomain (site name). (Optional)',
    '#weight' => -2,
  );
  $form['site_information']['site_unit_url'] = array(
    '#type' => 'textfield',
    '#title' => 'Parent unit - Base URL',
    '#default_value' => variable_get('site_unit_url', ''),
    '#description' => 'Required if the parent unit name is not empty. Must be an absolute URL (https://yourdomain.asu.edu, etc.)',
    '#weight' => -1,
    '#states' => array(
      'required' => array(
        ':input[name="site_unit_name"]' => array('empty' => FALSE),
      ),
    ),
  );
  $form['site_information']['site_name']['#weight'] = -3;
  $form['#validate'][] = '_webspark_megamenu_sisa_form_validate';
}

/**
 * Implements hook_access().
 */
function _webspark_megamenu_sisa_form_validate(&$form, &$form_state){
  if (!empty($form_state['values']['site_unit_name'])) {
    if ((filter_var($form_state['values']['site_unit_url'], FILTER_VALIDATE_URL) === FALSE)
      || (!valid_url($form_state['values']['site_unit_url']))) {
    form_set_error('site_unit_url', 'The site unit URL is not a valid URL.');
    }
  }
}
